<!DOCTYPE html>
<html lang="th">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="UTF-8" />
  <title>คำนวณปริมาณยา - Medical Dosage System</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=K2D:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "K2D", sans-serif;
      background-color: #CBEAEB; 
    }

    .logo-container {
      position: relative;
      width: fit-content;
      margin: 50px 0 0 20px;
      text-align: start;
    }

    .pills-background {
      width: 210px;
      opacity: 0.9;
      margin-top: -60px;
      transform: translateX(-25px);
    }
    
    nav {
      margin-left: auto;
      display: flex;
      gap: 20px;
    }
    
    nav a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: 17.5px;
      transition: all 0.3s;
      padding: 8px 15px;
      border-radius: 8px;
      position: relative;
    }
    
    nav a:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    header {
      flex-wrap: wrap;
      background: linear-gradient(135deg, #39AC95 100%, #2E8B7A 0%);
      display: flex;
      align-items: center;
      padding: 15px 30px;
      position: relative;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .login-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.3s;
      margin-left: 20px;
      text-decoration: none;
      display: inline-block;
    }
    
    .login-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .main-title { 
      text-align: center; 
      font-size: 27px; 
      font-weight: bold; 
      margin: 49px 0 45px 0; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      gap: 10px; 
      color: #2c3e50; 
    }

    .container {
      max-width: 780px;
      margin: 0 auto;
      padding: 20px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .section-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 20px;
      font-weight: bold;
      color: #2c3e50;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .patient-selection {
      margin-bottom: 30px;
    }

    .patient-row {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
      position: relative;
    }

    .patient-label {
      min-width: 80px;
      font-weight: 500;
      color: #2c3e50;
    }

    .patient-input {
      flex: 1;
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: white;
      font-family: "K2D", sans-serif;
      font-size: 16px;
      color: #2c3e50;
      transition: all 0.3s;
    }

    .patient-input:focus {
      outline: none;
      border-color: #39AC95;
      box-shadow: 0 0 0 3px rgba(57, 172, 149, 0.1);
    }

    .patient-input[readonly] {
      background: rgba(251, 250, 250, 0.3);
      cursor: pointer;
    }

    .select-btn {
      padding: 10px 20px;
      background: #39AC95;
      border: none;
      border-radius: 8px;
      font-family: "K2D", sans-serif;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .select-btn:hover {
      background: #2E8B7A;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(57, 172, 149, 0.3);
    }

    .medicine-input-wrapper {
      position: relative;
      flex: 1;
    }

    #medicineInput {
      width: 83%;
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-family: "K2D", sans-serif;
      font-size: 16px;
      transition: all 0.3s;
      background: white;
    }

    #medicineInput:focus {
      outline: none;
      border-color: #39AC95;
      box-shadow: 0 0 0 3px rgba(57, 172, 149, 0.1);
    }

    .medicine-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      margin-top: 5px;
      display: none;
    }

    .medicine-suggestion-item {
      padding: 12px 15px;
      border-bottom: 1px solid #f0f0f0;
      cursor: pointer;
      transition: background 0.2s;
    }

    .medicine-suggestion-item:hover {
      background: #f8f9fa;
    }

    .medicine-suggestion-item:last-child {
      border-bottom: none;
    }

    .calculation-section {
      margin-top: 40px;
    }

    .medicine-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .medicine-card {
      background: rgba(57, 172, 149, 0.1);
      border-radius: 15px;
      padding: 20px;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .medicine-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-color: #39AC95;
    }

    .card-header {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 15px;
      text-align: center;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(44, 62, 80, 0.2);
    }

    .medicine-info {
      background: #ebedef;
      border-radius: 6px;
      padding: 10px;
      margin-bottom: 8px;
      color: #3f3d3d;
      text-align: center;
      font-size: 14px;
    }

    .dosage-frequency-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    .dosage-input-group,
    .frequency-input-group {
      display: flex;
      flex-direction: column;
    }

    .dosage-input-group label,
    .frequency-input-group label {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 8px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .editable-input {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-family: "K2D", sans-serif;
      font-size: 16px;
      box-sizing: border-box;
      transition: all 0.3s;
      background: white;
    }

    .editable-input:focus {
      outline: none;
      border-color: #39AC95;
      box-shadow: 0 0 0 3px rgba(57, 172, 149, 0.1);
    }

    .guideline-box {
      background: linear-gradient(135deg, rgba(46, 213, 115, 0.1), rgba(39, 174, 96, 0.1));
      border-left: 4px solid #2eD573;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      margin-top: 20px;
    }

    .guideline-box h4 {
      color: #27AE60;
      margin: 0 0 10px 0;
      font-weight: 600;
      font-size: 14px;
    }

    .guideline-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 10px;
    }

    .guideline-item {
      text-align: center;
      padding: 10px;
      background: white;
      border-radius: 6px;
      border: 1px solid #E8F8F5;
    }

    .guideline-label {
      font-size: 12px;
      color: #7f8c8d;
      margin-bottom: 5px;
    }

    .guideline-value {
      font-size: 18px;
      font-weight: bold;
      color: #27AE60;
    }

    .calculate-button {
      width: 100%;
      height: 50px;
      background: linear-gradient(135deg, #39AC95, #2E8B7A);
      color: white;
      border: none;
      border-radius: 25px;
      font-family: "K2D", sans-serif;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: block;
      margin: 30px auto;
      box-shadow: 0 4px 15px rgba(57, 172, 149, 0.3);
    }

    .calculate-button:hover:not(:disabled) {
      background: linear-gradient(135deg, #2E8B7A, #1f6b57);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(57, 172, 149, 0.4);
    }

    .calculate-button:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      max-height: 70vh;
      overflow-y: auto;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #2c3e50;
    }

    .patient-list-item {
      padding: 15px;
      margin: 10px 0;
      background: rgba(57, 172, 149, 0.1);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .patient-list-item:hover {
      background: rgba(57, 172, 149, 0.2);
      border-color: #39AC95;
    }

    .close-modal {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }

    .no-data-message {
      text-align: center;
      padding: 30px;
      color: #7f8c8d;
      font-size: 16px;
    }

    .override-note {
      background: #e8f4fd;
      border-left: 4px solid #2196f3;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 13px;
    }

    .override-reason {
      width: 90%;
      padding: 8px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-family: "K2D", sans-serif;
      resize: vertical;
      min-height: 60px;
      transition: border-color 0.3s;
    }

    .override-reason:focus {
      outline: none;
      border-color: #39AC95;
      box-shadow: 0 0 0 3px rgba(57, 172, 149, 0.1);
    }

    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .popup-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .popup-container {
      background: white;
      border-radius: 15px;
      padding: 30px;
      max-width: 450px;
      width: 90%;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
      transform: scale(0.8);
      transition: all 0.3s ease;
      position: relative;
    }

    .popup-overlay.show .popup-container {
      transform: scale(1);
    }

    .popup-header {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      gap: 12px;
    }

    .popup-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: white;
    }

    .popup-icon.success {
      background: linear-gradient(135deg, #27ae60, #2ecc71);
    }

    .popup-icon.warning {
      background: linear-gradient(135deg, #f39c12, #e67e22);
    }

    .popup-title {
      font-size: 20px;
      font-weight: bold;
      color: #2c3e50;
      margin: 0;
    }

    .popup-message {
      text-align: center;
      color: #7f8c8d;
      font-size: 16px;
      line-height: 1.5;
      margin-bottom: 25px;
      white-space: pre-line;
    }

    .popup-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .popup-btn {
      padding: 10px 25px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }

    .popup-btn.primary {
      background: linear-gradient(135deg, #39AC95, #2E8B7A);
      color: white;
    }

    .popup-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(57, 172, 149, 0.3);
    }

    .popup-btn.secondary {
      background: #e0e0e0;
      color: #666;
    }

    .popup-btn.secondary:hover {
      background: #d0d0d0;
    }

    .popup-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      color: #95a5a6;
    }

    .popup-close:hover {
      color: #2c3e50;
    }

    .user-menu {
      position: relative;
      display: inline-block;
      margin-left: 20px;
    }

    .user-btn {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 8px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
      border: none;
      outline: none;
    }

    .user-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 8px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      min-width: 200px;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      margin-top: 5px;
    }

    .user-dropdown.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .user-dropdown a {
      display: block;
      padding: 12px 20px;
      color: #2c3e50 !important;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.3s;
    }

    .user-dropdown a:hover {
      background: #f8f9fa;
      color: #39AC95 !important;
    }

    .user-dropdown .divider {
      height: 1px;
      background: #e9ecef;
      margin: 8px 0;
    }

        .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 6px;
      font-size: 14px;
    }

    .info-box strong {
      color: #1976d2;
      font-size: 16px;
    }

    .info-box ol {
      color: #47494a;
    }

    .info-box i {
      color: #2196f3;
      font-size: 18px;
    }

    /* Disease Warning Box */
    #diseaseWarningBox {
      margin: 25px 0;
      padding: 0;
    }

    .disease-warning {
      background: #fff8e1;
      border-left: 5px solid #ff9800;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(255, 152, 0, 0.1);
    }

    .disease-warning .warning-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .disease-warning .warning-icon {
      background: #ff9800;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }

    .disease-warning strong {
      color: #e65100;
      font-size: 18px;
      font-weight: 700;
    }

    .disease-warning ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }

    .disease-warning ul li {
      padding: 10px 0;
      padding-left: 25px;
      position: relative;
      color: #5d4037;
      font-size: 15px;
      line-height: 1.6;
    }

    .disease-warning ul li:before {
      content: "→";
      position: absolute;
      left: 5px;
      color: #ff9800;
      font-weight: bold;
    }

    .factor-input-group {
      background: #fefefe;  /* เปลี่ยนจาก #f0f9ff เป็นสีเขียวอ่อน */
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;

    }

    .factor-input-group label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .factor-input-group label i {
      color: #66bb6a;  /* เปลี่ยนสีไอคอนเป็นเขียว */
      font-size: 18px;
    }

    .factor-input-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-family: "K2D", sans-serif;
      font-size: 16px;
      background: white;
      box-sizing: border-box;
    }

    .factor-input-group input:focus {
      outline: none;
      border-color: #ffffff;  /* เปลี่ยนเป็นเขียว */
      box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.1);  /* ปรับเป็นสีเขียว */

    }

    .factor-input-group input::placeholder {
      color: #95a5a6;
    }

    /* Input Hint */
    .input-hint {
      display: block;
      color: #7f8c8d;
      font-size: 13px;
      margin-top: 5px;
      font-style: italic;
    }

    .input-hint i {
      color: #3498db;
      margin-right: 5px;
      font-style: normal;  /* ยกเลิก italic สำหรับ icon */
    }

    /* Required Indicator */
    .required-indicator {
      color: #e74c3c;
      font-weight: bold;
      margin-left: 4px;
    }

    /* Disease Factors Container */
    #diseaseFactors {
      margin-top: 25px;
      padding: 25px;
      background: #e8f5e9;
      border: 3px dashed #2e7d32;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(102, 187, 106, 0.1);
    }

    #diseaseFactors .section-title {
      color: #2e7d32;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #diseaseFactors .section-title i {
      color: #66bb6a;
      font-size: 20px;
    }

    /* Dynamic Warning Messages */
    #dynamicWarningMessages {
      margin-top: 15px;
      padding: 0;
    }

    .warning-message-item {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 12px 15px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 14px;
      color: #856404;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .warning-message-item i {
      color: #ffc107;
      font-size: 16px;
      margin-top: 2px;
    }

    /* Guideline Text */
    #displayGuidelineText {
      background: #fcfcfc;
      padding: 15px;
      border-radius: 5px;
      margin-top: 15px;
      font-size: 15px;
      color: #2e7d32;
      line-height: 1.6;
    }

    #displayGuidelineText strong {
      color: #1b5e20;
      font-size: 16px;
    }
    /* Input Validation States */
    .factor-input-group input.valid {
      border-color: #27ae60;
      background: #e8f8f5;
    }

    .factor-input-group input.invalid {
      border-color: #e74c3c;
      background: #fadbd8;
    }

    /* Loading State */
    .calculate-button.loading {
      opacity: 0.7;
      cursor: wait;
    }

    .warning-message {
      background: #fff3cd;
      border-left: 4px solid #f39c12;
      padding: 12px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 13px;
      color: #856404;
    }

    .error-message {
      background: #f8d7da;
      border-left: 4px solid #e74c3c;
      padding: 12px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 13px;
      color: #721c24;
    }

    @media (max-width: 768px) {
      .medicine-cards {
        grid-template-columns: 1fr;
      }
      
      .patient-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .patient-label {
        min-width: auto;
        margin-bottom: 5px;
      }

      .dosage-frequency-group {
        grid-template-columns: 1fr;
      }

      .disease-warning {
        padding: 15px;
      }

      .disease-warning ul li {
        font-size: 14px;
      }

      .factor-input-group {
        padding: 15px;
      }

      #diseaseFactors {
        padding: 20px;
      }
      /* ========== MOBILE OPTIMIZATION ========== */

@media (max-width: 768px) {
  /* ===== Header ===== */
  header {
    padding: 8px 15px;
    flex-wrap: wrap;
  }

  .logo-container {
    margin: 0;
  }

  .pills-background {
    width: 150px;
    margin-top: -40px;
    transform: translateX(-10px);
  }

  /* ===== Navigation ===== */
  nav {
    margin-left: 0;
    width: 100%;
    gap: 8px;
    margin-top: 8px;
    overflow-x: auto;
    padding: 8px 0;
  }

  nav a {
    font-size: 13px;
    padding: 6px 10px;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .user-menu {
    margin-left: 0;
    margin-top: 8px;
  }

  .user-btn {
    font-size: 11px;
    padding: 6px 12px;
  }

  /* ===== Main Title ===== */
  .main-title {
    font-size: 22px;
    margin: 20px 10px;
    gap: 8px;
  }

  /* ===== Container ===== */
  .container {
    max-width: 90%;
    padding: 15px;
    margin: 20px auto;
  }

  /* ===== Form Elements ===== */
  input[type="text"],
  input[type="password"],
  input[type="email"],
  input[type="number"],
  select,
  textarea {
    padding: 12px 12px;
    font-size: 16px; /* ป้องกัน auto-zoom บน iOS */
  }

  /* ===== Buttons ===== */
  button,
  .btn,
  .submit-btn,
  .calculate-button {
    padding: 12px 20px;
    font-size: 15px;
    min-height: 44px; /* Touch target size */
    min-width: 44px;
  }

  /* ===== Cards & Sections ===== */
  .medicine-cards {
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .info-section {
    padding: 15px;
  }

  /* ===== Tables ===== */
  .table-header,
  .table-row {
    grid-template-columns: 1fr;
    gap: 10px;
    padding: 12px;
  }

  .table-header {
    display: none; /* ซ่อน header บน mobile */
  }

  .table-row {
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 15px;
  }

  .table-row::before {
    content: attr(data-label);
    font-weight: bold;
    color: #39AC95;
  }

  /* ===== Modal ===== */
  .modal-content {
    width: 95%;
    padding: 20px;
  }

  /* ===== Popup ===== */
  .popup-container {
    width: 90%;
    padding: 20px;
  }

  /* ===== Grid Layouts ===== */
  .patient-medicine-info {
    grid-template-columns: 1fr;
  }

  .grid-box {
    grid-template-columns: 1fr;
    gap: 15px;
  }

  .action-box {
    min-height: 120px;
    padding: 20px 15px;
  }

  .action-box .icon {
    width: 60px;
    height: 60px;
  }

  .action-box span {
    font-size: 16px;
  }

  /* ===== Search ===== */
  .search-container {
    padding: 15px;
    max-width: 100%;
  }

  .search-input {
    padding: 10px 12px;
    font-size: 16px;
  }

  /* ===== dosage boxes ===== */
  .dosage-boxes {
    grid-template-columns: 1fr;
  }

  /* ===== Form rows ===== */
  .form-row {
    flex-direction: column;
    gap: 0;
  }

  .form-row .form-group {
    margin-bottom: 15px;
  }

  .w3-col.s6 {
    padding: 0 !important;
    margin-bottom: 15px;
  }
}

/* ========== EXTRA SMALL DEVICES ========== */

@media (max-width: 480px) {
  header {
    padding: 6px 10px;
  }

  .pills-background {
    width: 120px;
    margin-top: -30px;
    transform: translateX(-5px);
  }

  .main-title {
    font-size: 18px;
    margin: 15px 10px;
  }

  .subtitle {
    font-size: 14px;
  }

  nav a {
    font-size: 12px;
    padding: 5px 8px;
  }

  button,
  .btn,
  .submit-btn,
  .calculate-button {
    padding: 10px 16px;
    font-size: 14px;
  }

  .form-label {
    font-size: 14px;
  }

  input[type="text"],
  input[type="password"],
  input[type="email"],
  input[type="number"],
  select,
  textarea {
    font-size: 16px;
    padding: 10px;
  }

  .container {
    padding: 10px;
  }

  .card {
    padding: 15px;
  }

  /* ป้องกัน double-tap zoom delay */
  input,
  select,
  textarea,
  button {
    touch-action: manipulation;
  }
}

/* ========== Landscape Mode ========== */

@media (max-height: 500px) {
  header {
    padding: 6px 15px;
  }

  .pills-background {
    width: 100px;
    margin-top: -20px;
  }

  nav {
    gap: 5px;
  }

  nav a {
    padding: 4px 8px;
    font-size: 12px;
  }
}
    }
        .medicine-list-item {
      padding: 15px;
      margin: 10px 0;
      background: rgba(57, 172, 149, 0.1);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .medicine-list-item:hover {
      background: rgba(57, 172, 149, 0.2);
      border-color: #39AC95;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(57, 172, 149, 0.2);
    }

    /* ✅ NEW: Style สำหรับ Child-Pugh Class Selector */
    .childpugh-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .childpugh-option {
      padding: 15px;
      background: white;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s;
    }

    .childpugh-option:hover {
      border-color: #39AC95;
      background: rgba(57, 172, 149, 0.1);
    }

    .childpugh-option.selected {
      border-color: #27ae60;
      background: #e8f8f5;
    }

    .childpugh-option .class-label {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 5px;
    }

    .childpugh-option .class-desc {
      font-size: 12px;
      color: #7f8c8d;
    }

    .childpugh-option.class-a .class-label { color: #27ae60; }
    .childpugh-option.class-b .class-label { color: #f39c12; }
    .childpugh-option.class-c .class-label { color: #e74c3c; }
    .medicine-list-item {
        padding: 15px;
        margin: 10px 0;
        background: rgba(57, 172, 149, 0.1);
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        border: 2px solid transparent;
      }

      .medicine-list-item:hover {
        background: rgba(57, 172, 149, 0.2);
        border-color: #39AC95;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(57, 172, 149, 0.2);
      }

      .medicine-list-item h5 {
        margin: 0 0 5px 0;
        color: #2c3e50;
        font-weight: 600;
      }

      .medicine-list-item p {
        margin: 5px 0;
        font-size: 13px;
        color: #7f8c8d;
      }
  </style>
</head>
<body>
<header>
  <div class="logo-container">
    <img src="logopj.png" alt="Pills" class="pills-background">
  </div>
  <nav>
    <a href="homepage.html">หน้าหลัก</a>
    <a href="managepatientdata.html">จัดการข้อมูลผู้ป่วย</a>
    <a href="medicine.html">ข้อมูลยา</a>
    <a href="calculatemed.html">คำนวณปริมาณยา</a>
    <a href="history.html">ประวัติการคำนวณยา</a>
    <span id="authSection"></span>
  </nav>
</header>

<div class="main-title">
    <i class="fa fa-calculator"></i>
    <div class="title">คำนวณปริมาณยา</div>
</div>

<div class="container">
  <div class="section-header">
    <div class="section-title">
      <i class="fa fa-user"></i>
      <span>ข้อมูลคนไข้</span>
    </div>
  </div>

  <div class="patient-selection">
    <!-- ✅ Patient Selection - ใช้ Modal -->
    <div class="patient-row">
      <span class="patient-label">ผู้ป่วย:</span>
      <input type="text" id="patientName" class="patient-input" placeholder="เลือกผู้ป่วย..." readonly onclick="openPatientModal()">
      <button class="select-btn" onclick="openPatientModal()">เลือก</button>
    </div>
    <div id="medicineModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <i class="fas fa-pills"></i> เลือกยาที่กรอกปัจจัยแล้ว
      </div>
      <div id="medicineList"></div>
      <button class="close-modal" onclick="closeMedicineModal()">ปิด</button>
    </div>
  </div>
    
    <!-- ✅ Medicine Selection - เปลี่ยนเป็น Modal -->
    <div class="patient-row">
      <span class="patient-label">ยา:</span>
      <input type="text" id="medicineInput" class="patient-input" placeholder="เลือกยา..." readonly onclick="openMedicineModal()">
      <div id="medicineList"></div>
      <button class="select-btn" onclick="openMedicineModal()">เลือก</button>
    </div>
  </div>

  <div class="calculation-section">
    <div class="section-title">
      <span>คำนวณปริมาณยา</span>
    </div>

    <div class="medicine-cards">
      <div class="medicine-card">
        <div class="card-header">ข้อมูลผู้ป่วย</div>
        <div class="medicine-info">ชื่อ: <span id="displayName">-</span></div>
        <div class="medicine-info">อายุ: <span id="displayAge">-</span></div>
        <div class="medicine-info">น้ำหนัก: <span id="displayWeight">-</span></div>
        <div class="medicine-info">โรคประจำตัว: <span id="displayDisease">-</span></div>
      </div>

     <div class="medicine-card">
        <div class="card-header">ข้อมูลยา</div>
        <div class="medicine-info">ชื่อยา: <span id="selectedMedicineName">-</span></div>
        <div class="medicine-info">ประเภท: <span id="selectedMedicineType">-</span></div>
        
        <div class="dosage-frequency-group">
          <div class="dosage-input-group">
            <label for="actualDosage">
              <i class="fas fa-weight"></i> ขนาดยา (mg/dose)
            </label>
            <input type="number" id="actualDosage" class="editable-input" placeholder="ขนาดยาจ่ายจริง" min="1" step="0.1" oninput="checkAdjustmentDeviation()">
          </div>

          <div class="frequency-input-group">
            <label for="actualFrequencyText">
              <i class="fas fa-clock"></i> ความถี่ที่ใช้
            </label>
            <select id="actualFrequencyText" class="editable-input" onchange="checkAdjustmentDeviation()">
              <option value="">-- ความถี่จ่ายจริง --</option>
              <option value="OD">วันละ 1 ครั้ง (OD)</option>
              <option value="BID">วันละ 2 ครั้ง (BID)</option>
              <option value="TID">วันละ 3 ครั้ง (TID)</option>
              <option value="QID">วันละ 4 ครั้ง (QID)</option>
              <option value="Q8H">ทุก 8 ชั่วโมง(Q8H)</option>
              <option value="Q6H">ทุก 6 ชั่วโมง(Q6H)</option>
              <option value="PRN">ตามอาการ (PRN)</option>
            </select>
          </div>
        </div>
      </div>
    </div>
    <div class="info-box">
      <strong><i class="fas fa-info-circle"></i> วิธีการใช้งาน</strong>
      <p style="margin: 8px 0 0 0; line-height: 3;">
        กดปุ่ม "คำนวณปริมาณยา" → ระบบแสดงค่า Guideline → กรอกขนาดยาและความถี่ที่ต้องการจ่าย → บันทึกและไปหน้าสรุปผล
      </p>
    </div>

    <!-- Disease Warning Box -->
    <div id="diseaseWarningBox" style="display: none;"></div>

    <!-- ✅ Disease Factors - Updated with Child-Pugh Class -->
    <div id="diseaseFactors" style="display:none;">
      <div class="section-title">
        <i class="fas fa-notes-medical"></i> ปัจจัยเฉพาะโรค
      </div>

      <!-- CrCl -->
      <div id="factor-crcl" class="factor-input-group" style="display:none;">
        <label for="input_crcl">
          <i class="fas fa-vial"></i> 
          ค่า CrCl (Creatinine Clearance)
          <span class="required-indicator">*</span>
        </label>
        <input 
          type="number" 
          id="input_crcl" 
          placeholder="กรอกค่า CrCl เช่น 85.5" 
          step="0.1"
          min="0"
          max="200">
        <span class="input-hint">
          <i class="fas fa-info-circle"></i>
          ใช้สำหรับปรับขนาดยาในผู้ป่วยไตวาย (ค่าต่ำกว่า 60 mL/min ต้องปรับยา)
        </span>
      </div>
    
      <!-- ✅ Child-Pugh Class Selector (แทน Score) -->
      <div id="factor-childpugh" class="factor-input-group" style="display:none;">
        <label>
          <i class="fas fa-liver"></i> 
          Child-Pugh Class (ระดับความรุนแรงของตับ)
          <span class="required-indicator">*</span>
        </label>
        <input type="hidden" id="input_childpugh" value="">
        
        <div class="childpugh-selector">
          <div class="childpugh-option class-a" onclick="selectChildPughClass('A')">
            <div class="class-label">A</div>
            <div class="class-desc">ตับทำงานปกติ<br>(5-6 คะแนน)</div>
          </div>
          <div class="childpugh-option class-b" onclick="selectChildPughClass('B')">
            <div class="class-label">B</div>
            <div class="class-desc">ตับวายปานกลาง<br>(7-9 คะแนน)</div>
          </div>
          <div class="childpugh-option class-c" onclick="selectChildPughClass('C')">
            <div class="class-label">C</div>
            <div class="class-desc">ตับวายรุนแรง<br>(10-15 คะแนน)</div>
          </div>
        </div>
        
        <span class="input-hint">
          <i class="fas fa-info-circle"></i>
          ระบบจะปรับขนาดยาตาม Child-Pugh Class โดยอัตโนมัติ
        </span>
      </div>
    
      <!-- Adjusted Body Weight -->
      <div id="factor-adjbw" class="factor-input-group" style="display:none;">
        <label for="input_adjbw">
          <i class="fas fa-weight"></i> 
          Adjusted Body Weight (ABW)
          <span class="required-indicator">*</span>
        </label>
        <input 
          type="number" 
          id="input_adjbw" 
          placeholder="กรอกน้ำหนักที่ปรับแล้ว เช่น 75.5" 
          step="0.1"
          min="0">
        <span class="input-hint">
          <i class="fas fa-info-circle"></i>
          ใช้แทนน้ำหนักจริงในผู้ป่วยอ้วน (BMI > 30) เพื่อหลีกเลี่ยง Overdose
        </span>
      </div>
    
      <!-- Body Surface Area -->
      <div id="factor-bsa" class="factor-input-group" style="display:none;">
        <label for="input_bsa">
          <i class="fas fa-ruler-combined"></i> 
          Body Surface Area (BSA)
          <span class="required-indicator">*</span>
        </label>
        <input 
          type="number" 
          id="input_bsa" 
          placeholder="กรอกค่า BSA เช่น 1.75" 
          step="0.01"
          min="0"
          max="3">
        <span class="input-hint">
          <i class="fas fa-info-circle"></i>
          ค่า BSA ใช้คำนวณขนาดยาเคมีบำบัดอย่างแม่นยำ (ปกติ: 1.5-2.0 m²)
        </span>
      </div>
    </div>

    <div id="dosageCalculationResult" style="display: none;">
      <!-- Guideline Box -->
      <div class="guideline-box">
        <h4><i class="fas fa-lightbulb"></i> ค่า Guideline ที่แนะนำ</h4>
        <div class="guideline-content">
          <div class="guideline-item">
            <div class="guideline-label">ขนาดยาที่แนะนำ</div>
            <div class="guideline-value" id="displayGuidelineDose">--</div>
            <div class="guideline-label">mg/dose</div>
          </div>
          <div class="guideline-item">
            <div class="guideline-label">ความถี่ที่แนะนำ</div>
            <div class="guideline-value" id="displayGuidelineFreq">--</div>
            <div class="guideline-label">ครั้งต่อวัน</div>
          </div>
        </div>

        <!-- Guideline Text -->
        <div id="displayGuidelineText">
          <strong>แนวทาง:</strong> N/A
        </div>
      </div>
    
      <!-- Dynamic Warning Messages -->
      <div id="dynamicWarningMessages" style="display:none;"></div>
    
      <!-- Hidden inputs -->
      <input type="hidden" id="recommendedMinDose" value="0">
      <input type="hidden" id="recommendedMaxDose" value="0">
      <input type="hidden" id="recommendedFrequencyText" value="">
      <input type="hidden" id="recommendedFrequencyInt" value="0">
    
      <!-- Override Reason -->
      <div class="override-note" id="adjustmentReasonGroup" style="display:none;">
        <h5 style="margin-top: 0; color: #2196f3; font-weight: 600;">
          <i class="fas fa-exclamation-circle"></i> การปรับแก้ข้อมูลยา
        </h5>
        <p style="margin: 10px 0; font-size: 13px;">
          ขนาดยาหรือความถี่ที่ท่านระบุแตกต่างจาก Guideline กรุณาระบุเหตุผลการปรับแก้
        </p>
        <label style="font-weight: 600; font-size: 13px; color: #2c3e50;">เหตุผลการปรับแก้:</label>
        <textarea 
          id="overrideReason" 
          class="override-reason" 
          placeholder="ระบุเหตุผลการปรับแก้ข้อมูลยา เช่น สภาพผู้ป่วย ความไม่ทนการออกฤทธิ์ของยา เป็นต้น"></textarea>
        <p class="warning-message" id="reasonWarning" style="display: none;">
          <i class="fas fa-asterisk" style="color: red;"></i> การปรับแก้มากกว่า 20% กรุณาให้เหตุผลที่ชัดเจน
        </p>
      </div>
    </div>

    <!-- Calculate Button -->
    <button class="calculate-button" id="triggerCalculationBtn" onclick="triggerDosageCalculation()">
       คำนวณปริมาณยา
    </button>

    <!-- Proceed Button -->
    <button class="calculate-button" id="proceedToResultBtn" onclick="proceedToResult()" style="display: none; background: linear-gradient(135deg, #27AE60, #229954);">
      <i class="fas fa-check-circle"></i> บันทึกและไปหน้าสรุปผล
    </button>
  </div>
</div>

<!-- Patient Modal -->
<div id="patientModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">เลือกผู้ป่วย</div>
    <div id="patientList"></div>
    <button class="close-modal" onclick="closePatientModal()">ปิด</button>
  </div>
</div>

<!-- Warning Popup -->
<div class="popup-overlay" id="warningPopup">
  <div class="popup-container">
    <button class="popup-close" onclick="closeWarningPopup()"><i class="fas fa-times"></i></button>
    <div class="popup-header">
      <div class="popup-icon warning"><i class="fas fa-exclamation-triangle"></i></div>
      <div class="popup-title" id="warningTitle">คำเตือน</div>
    </div>
    <div class="popup-message" id="warningMsg"></div>
    <div class="popup-buttons">
      <button class="popup-btn primary" onclick="proceedWithWarning()">ดำเนินการต่อ</button>
      <button class="popup-btn secondary" onclick="closeWarningPopup()">ยกเลิก</button>
    </div>
  </div>
</div>

<!-- Logout Popup -->
<div class="popup-overlay" id="logoutPopup">
  <div class="popup-container">
    <button class="popup-close" onclick="closeLogoutPopup()"><i class="fas fa-times"></i></button>
    <div class="popup-header">
      <div class="popup-icon warning"><i class="fas fa-sign-out-alt"></i></div>
      <div class="popup-title">ออกจากระบบ</div>
    </div>
    <div class="popup-message">คุณต้องการออกจากระบบหรือไม่?</div>
    <div class="popup-buttons">
      <button class="popup-btn primary" onclick="confirmLogout()">ตกลง</button>
      <button class="popup-btn secondary" onclick="closeLogoutPopup()">ยกเลิก</button>
    </div>
  </div>
</div>

<!-- Result Popup -->
<div class="popup-overlay" id="resultPopup">
  <div class="popup-container">
    <button class="popup-close" onclick="closeResultPopup()"><i class="fas fa-times"></i></button>
    <div class="popup-header">
      <div class="popup-icon success" id="resultIcon"><i class="fas fa-check"></i></div>
      <div class="popup-title" id="resultTitle"></div>
    </div>
    <div class="popup-message" id="resultMsg"></div>
    <div class="popup-buttons">
      <button class="popup-btn primary" onclick="closeResultPopup()">ปิด</button>
    </div>
  </div>
</div>
<script src="clienthelper.js"></script>
<script src="calculatemed.js"></script>
</body>
</html>